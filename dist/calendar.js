!function(t){"function"==typeof define&&define.amd?define("jquery.ui/position",["jquery"],t):t(jQuery)}(function(t){return function(){function e(t,e,i){return[parseFloat(t[0])*(f.test(t[0])?e/100:1),parseFloat(t[1])*(f.test(t[1])?i/100:1)]}function i(e,i){return parseInt(t.css(e,i),10)||0}function n(e){var i=e[0];return 9===i.nodeType?{width:e.width(),height:e.height(),offset:{top:0,left:0}}:t.isWindow(i)?{width:e.width(),height:e.height(),offset:{top:e.scrollTop(),left:e.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:e.outerWidth(),height:e.outerHeight(),offset:e.offset()}}t.ui=t.ui||{};var s,a,r=Math.max,o=Math.abs,l=Math.round,d=/left|center|right/,c=/top|center|bottom/,p=/[\+\-]\d+(\.[\d]+)?%?/,h=/^\w+/,f=/%$/,m=t.fn.position;t.position={scrollbarWidth:function(){if(void 0!==s)return s;var e,i,n=t("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),a=n.children()[0];return t("body").append(n),e=a.offsetWidth,n.css("overflow","scroll"),i=a.offsetWidth,e===i&&(i=n[0].clientWidth),n.remove(),s=e-i},getScrollInfo:function(e){var i=e.isWindow||e.isDocument?"":e.element.css("overflow-x"),n=e.isWindow||e.isDocument?"":e.element.css("overflow-y"),s="scroll"===i||"auto"===i&&e.width<e.element[0].scrollWidth,a="scroll"===n||"auto"===n&&e.height<e.element[0].scrollHeight;return{width:a?t.position.scrollbarWidth():0,height:s?t.position.scrollbarWidth():0}},getWithinInfo:function(e){var i=t(e||window),n=t.isWindow(i[0]),s=!!i[0]&&9===i[0].nodeType;return{element:i,isWindow:n,isDocument:s,offset:i.offset()||{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:n||s?i.width():i.outerWidth(),height:n||s?i.height():i.outerHeight()}}},t.fn.position=function(s){if(!s||!s.of)return m.apply(this,arguments);s=t.extend({},s);var f,u,v,g,_,w,y=t(s.of),b=t.position.getWithinInfo(s.within),k=t.position.getScrollInfo(b),x=(s.collision||"flip").split(" "),j={};return w=n(y),y[0].preventDefault&&(s.at="left top"),u=w.width,v=w.height,g=w.offset,_=t.extend({},g),t.each(["my","at"],function(){var t,e,i=(s[this]||"").split(" ");1===i.length&&(i=d.test(i[0])?i.concat(["center"]):c.test(i[0])?["center"].concat(i):["center","center"]),i[0]=d.test(i[0])?i[0]:"center",i[1]=c.test(i[1])?i[1]:"center",t=p.exec(i[0]),e=p.exec(i[1]),j[this]=[t?t[0]:0,e?e[0]:0],s[this]=[h.exec(i[0])[0],h.exec(i[1])[0]]}),1===x.length&&(x[1]=x[0]),"right"===s.at[0]?_.left+=u:"center"===s.at[0]&&(_.left+=u/2),"bottom"===s.at[1]?_.top+=v:"center"===s.at[1]&&(_.top+=v/2),f=e(j.at,u,v),_.left+=f[0],_.top+=f[1],this.each(function(){var n,d,c=t(this),p=c.outerWidth(),h=c.outerHeight(),m=i(this,"marginLeft"),w=i(this,"marginTop"),C=p+m+i(this,"marginRight")+k.width,T=h+w+i(this,"marginBottom")+k.height,L=t.extend({},_),M=e(j.my,c.outerWidth(),c.outerHeight());"right"===s.my[0]?L.left-=p:"center"===s.my[0]&&(L.left-=p/2),"bottom"===s.my[1]?L.top-=h:"center"===s.my[1]&&(L.top-=h/2),L.left+=M[0],L.top+=M[1],a||(L.left=l(L.left),L.top=l(L.top)),n={marginLeft:m,marginTop:w},t.each(["left","top"],function(e,i){t.ui.position[x[e]]&&t.ui.position[x[e]][i](L,{targetWidth:u,targetHeight:v,elemWidth:p,elemHeight:h,collisionPosition:n,collisionWidth:C,collisionHeight:T,offset:[f[0]+M[0],f[1]+M[1]],my:s.my,at:s.at,within:b,elem:c})}),s.using&&(d=function(t){var e=g.left-L.left,i=e+u-p,n=g.top-L.top,a=n+v-h,l={target:{element:y,left:g.left,top:g.top,width:u,height:v},element:{element:c,left:L.left,top:L.top,width:p,height:h},horizontal:0>i?"left":e>0?"right":"center",vertical:0>a?"top":n>0?"bottom":"middle"};p>u&&o(e+i)<u&&(l.horizontal="center"),h>v&&o(n+a)<v&&(l.vertical="middle"),r(o(e),o(i))>r(o(n),o(a))?l.important="horizontal":l.important="vertical",s.using.call(this,t,l)}),c.offset(t.extend(L,{using:d}))})},t.ui.position={fit:{left:function(t,e){var i,n=e.within,s=n.isWindow?n.scrollLeft:n.offset.left,a=n.width,o=t.left-e.collisionPosition.marginLeft,l=s-o,d=o+e.collisionWidth-a-s;e.collisionWidth>a?l>0&&0>=d?(i=t.left+l+e.collisionWidth-a-s,t.left+=l-i):d>0&&0>=l?t.left=s:l>d?t.left=s+a-e.collisionWidth:t.left=s:l>0?t.left+=l:d>0?t.left-=d:t.left=r(t.left-o,t.left)},top:function(t,e){var i,n=e.within,s=n.isWindow?n.scrollTop:n.offset.top,a=e.within.height,o=t.top-e.collisionPosition.marginTop,l=s-o,d=o+e.collisionHeight-a-s;e.collisionHeight>a?l>0&&0>=d?(i=t.top+l+e.collisionHeight-a-s,t.top+=l-i):d>0&&0>=l?t.top=s:l>d?t.top=s+a-e.collisionHeight:t.top=s:l>0?t.top+=l:d>0?t.top-=d:t.top=r(t.top-o,t.top)}},flip:{left:function(t,e){var i,n,s=e.within,a=s.offset.left+s.scrollLeft,r=s.width,l=s.isWindow?s.scrollLeft:s.offset.left,d=t.left-e.collisionPosition.marginLeft,c=d-l,p=d+e.collisionWidth-r-l,h="left"===e.my[0]?-e.elemWidth:"right"===e.my[0]?e.elemWidth:0,f="left"===e.at[0]?e.targetWidth:"right"===e.at[0]?-e.targetWidth:0,m=-2*e.offset[0];0>c?(i=t.left+h+f+m+e.collisionWidth-r-a,(0>i||i<o(c))&&(t.left+=h+f+m)):p>0&&(n=t.left-e.collisionPosition.marginLeft+h+f+m-l,(n>0||o(n)<p)&&(t.left+=h+f+m))},top:function(t,e){var i,n,s=e.within,a=s.offset.top+s.scrollTop,r=s.height,l=s.isWindow?s.scrollTop:s.offset.top,d=t.top-e.collisionPosition.marginTop,c=d-l,p=d+e.collisionHeight-r-l,h="top"===e.my[1],f=h?-e.elemHeight:"bottom"===e.my[1]?e.elemHeight:0,m="top"===e.at[1]?e.targetHeight:"bottom"===e.at[1]?-e.targetHeight:0,u=-2*e.offset[1];0>c?(n=t.top+f+m+u+e.collisionHeight-r-a,t.top+f+m+u>c&&(0>n||n<o(c))&&(t.top+=f+m+u)):p>0&&(i=t.top-e.collisionPosition.marginTop+f+m+u-l,t.top+f+m+u>p&&(i>0||o(i)<p)&&(t.top+=f+m+u))}},flipfit:{left:function(){t.ui.position.flip.left.apply(this,arguments),t.ui.position.fit.left.apply(this,arguments)},top:function(){t.ui.position.flip.top.apply(this,arguments),t.ui.position.fit.top.apply(this,arguments)}}},function(){var e,i,n,s,r,o=document.getElementsByTagName("body")[0],l=document.createElement("div");e=document.createElement(o?"div":"body"),n={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},o&&t.extend(n,{position:"absolute",left:"-1000px",top:"-1000px"});for(r in n)e.style[r]=n[r];e.appendChild(l),i=o||document.documentElement,i.insertBefore(e,i.firstChild),l.style.cssText="position: absolute; left: 10.7432222px;",s=t(l).offset().left,a=s>10&&11>s,e.innerHTML="",i.removeChild(e)}()}(),t.ui.position}),function(t){"function"==typeof define&&define.amd?define("jquery.ui/tooltip",["jquery","./core","./widget","./position"],t):t(jQuery)}(function(t){return t.widget("ui.tooltip",{version:"1.11.1",options:{content:function(){var e=t(this).attr("title")||"";return t("<a>").text(e).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,tooltipClass:null,track:!1,close:null,open:null},_addDescribedBy:function(e,i){var n=(e.attr("aria-describedby")||"").split(/\s+/);n.push(i),e.data("ui-tooltip-id",i).attr("aria-describedby",t.trim(n.join(" ")))},_removeDescribedBy:function(e){var i=e.data("ui-tooltip-id"),n=(e.attr("aria-describedby")||"").split(/\s+/),s=t.inArray(i,n);-1!==s&&n.splice(s,1),e.removeData("ui-tooltip-id"),n=t.trim(n.join(" ")),n?e.attr("aria-describedby",n):e.removeAttr("aria-describedby")},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.options.disabled&&this._disable(),this.liveRegion=t("<div>").attr({role:"log","aria-live":"assertive","aria-relevant":"additions"}).addClass("ui-helper-hidden-accessible").appendTo(this.document[0].body)},_setOption:function(e,i){var n=this;return"disabled"===e?(this[i?"_disable":"_enable"](),void(this.options[e]=i)):(this._super(e,i),void("content"===e&&t.each(this.tooltips,function(t,e){n._updateContent(e)})))},_disable:function(){var e=this;t.each(this.tooltips,function(i,n){var s=t.Event("blur");s.target=s.currentTarget=n[0],e.close(s,!0)}),this.element.find(this.options.items).addBack().each(function(){var e=t(this);e.is("[title]")&&e.data("ui-tooltip-title",e.attr("title")).removeAttr("title")})},_enable:function(){this.element.find(this.options.items).addBack().each(function(){var e=t(this);e.data("ui-tooltip-title")&&e.attr("title",e.data("ui-tooltip-title"))})},open:function(e){var i=this,n=t(e?e.target:this.element).closest(this.options.items);n.length&&!n.data("ui-tooltip-id")&&(n.attr("title")&&n.data("ui-tooltip-title",n.attr("title")),n.data("ui-tooltip-open",!0),e&&"mouseover"===e.type&&n.parents().each(function(){var e,n=t(this);n.data("ui-tooltip-open")&&(e=t.Event("blur"),e.target=e.currentTarget=this,i.close(e,!0)),n.attr("title")&&(n.uniqueId(),i.parents[this.id]={element:this,title:n.attr("title")},n.attr("title",""))}),this._updateContent(n,e))},_updateContent:function(t,e){var i,n=this.options.content,s=this,a=e?e.type:null;return"string"==typeof n?this._open(e,t,n):(i=n.call(t[0],function(i){t.data("ui-tooltip-open")&&s._delay(function(){e&&(e.type=a),this._open(e,t,i)})}),void(i&&this._open(e,t,i)))},_open:function(e,i,n){function s(t){d.of=t,a.is(":hidden")||a.position(d)}var a,r,o,l,d=t.extend({},this.options.position);if(n){if(a=this._find(i),a.length)return void a.find(".ui-tooltip-content").html(n);i.is("[title]")&&(e&&"mouseover"===e.type?i.attr("title",""):i.removeAttr("title")),a=this._tooltip(i),this._addDescribedBy(i,a.attr("id")),a.find(".ui-tooltip-content").html(n),this.liveRegion.children().hide(),n.clone?(l=n.clone(),l.removeAttr("id").find("[id]").removeAttr("id")):l=n,t("<div>").html(l).appendTo(this.liveRegion),this.options.track&&e&&/^mouse/.test(e.type)?(this._on(this.document,{mousemove:s}),s(e)):a.position(t.extend({of:i},this.options.position)),this.hiding=!1,this.closing=!1,a.hide(),this._show(a,this.options.show),this.options.show&&this.options.show.delay&&(o=this.delayedShow=setInterval(function(){a.is(":visible")&&(s(d.of),clearInterval(o))},t.fx.interval)),this._trigger("open",e,{tooltip:a}),r={keyup:function(e){if(e.keyCode===t.ui.keyCode.ESCAPE){var n=t.Event(e);n.currentTarget=i[0],this.close(n,!0)}}},i[0]!==this.element[0]&&(r.remove=function(){this._removeTooltip(a)}),e&&"mouseover"!==e.type||(r.mouseleave="close"),e&&"focusin"!==e.type||(r.focusout="close"),this._on(!0,i,r)}},close:function(e){var i=this,n=t(e?e.currentTarget:this.element),s=this._find(n);this.closing||(clearInterval(this.delayedShow),n.data("ui-tooltip-title")&&!n.attr("title")&&n.attr("title",n.data("ui-tooltip-title")),this._removeDescribedBy(n),this.hiding=!0,s.stop(!0),this._hide(s,this.options.hide,function(){i._removeTooltip(t(this)),this.hiding=!1,this.closing=!1}),n.removeData("ui-tooltip-open"),this._off(n,"mouseleave focusout keyup"),n[0]!==this.element[0]&&this._off(n,"remove"),this._off(this.document,"mousemove"),e&&"mouseleave"===e.type&&t.each(this.parents,function(e,n){t(n.element).attr("title",n.title),delete i.parents[e]}),this.closing=!0,this._trigger("close",e,{tooltip:s}),this.hiding||(this.closing=!1))},_tooltip:function(e){var i=t("<div>").attr("role","tooltip").addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+(this.options.tooltipClass||"")),n=i.uniqueId().attr("id");return t("<div>").addClass("ui-tooltip-content").appendTo(i),i.appendTo(this.document[0].body),this.tooltips[n]=e,i},_find:function(e){var i=e.data("ui-tooltip-id");return i?t("#"+i):t()},_removeTooltip:function(t){t.remove(),delete this.tooltips[t.attr("id")]},_destroy:function(){var e=this;t.each(this.tooltips,function(i,n){var s=t.Event("blur");s.target=s.currentTarget=n[0],e.close(s,!0),t("#"+i).remove(),n.data("ui-tooltip-title")&&(n.attr("title")||n.attr("title",n.data("ui-tooltip-title")),n.removeData("ui-tooltip-title"))}),this.liveRegion.remove()}})}),define("components/requirejs-text/text!component/../../template/component/meetingroombookings.tpl.html",[],function(){return'<div class="u-mrbookings">\r\n    <div class="u-row-part u-bookings-content">\r\n        <div class="u-row-part-title">\r\n            <div class="f-fl">\r\n                <a href="javascript:void(0);" class="u-title-today">{{i18n \'calendar/ui_today\'}} <span class="j-set-today">2016-01-08</span></a>\r\n            </div>\r\n            <div class="cal-date">\r\n                <a href="javascript:void(0);" class="cal-mi-icon iconfont iconprevious j-cal-action f-fl" data-cal="-1"></a>\r\n                <input class="cal-date-sel f-fl" datepicker type="text">\r\n                <a href="javascript:void(0);" class="cal-mi-icon iconfont iconnext j-cal-action" data-cal="1"></a>\r\n            </div>\r\n        </div>\r\n        <div class="j-show-list"></div>\r\n    </div>\r\n\r\n    <div class="u-row-part u-mr-list">\r\n        <div class="u-row-part-title">{{i18n \'calendar/ui_mr_list\'}}</div>\r\n        <ul class="u-list j-mr-list"></ul>\r\n    </div>\r\n\r\n    <div class="u-bookings-tip"></div>\r\n    {{#raw}}\r\n    <!--浼氳瀹ゅ垪琛�-->\r\n    <script id="mrListTpl" type="text/x-handlebars-template">\r\n        [[#each .]]\r\n        <li class="mr-item [[#if selected]] active[[/if]]" data-id="[[id]]">[[true_name]]</li>\r\n        [[/each]]\r\n    </script>\r\n    <!--浼氳瀹ら瀹氳鎯�-->\r\n    <script id="showMRListTpl" type="text/x-handlebars-template">\r\n        <table class="u-mr-show-list" cellpadding="0" cellspacing="0">\r\n            <tbody>\r\n            <tr>\r\n                <td style="width:64px;text-align: right;"><a class="iconfont iconprevious j-mr-action[[#if isPreDisabled]] disable[[/if]][[#if hideOps]] f-dn[[/if]]" data-cal="-1" href="javascript:;"></a></td>\r\n                [[#compare showList.length "==" 0]]\r\n                    <th width="100%">{{i18n \'calendar/msg_select_mr\'}}</th>\r\n                [[else]]\r\n                    [[#each showList]]\r\n                    <th style="width: [[math 462 \'/\' ../showList.length]]px"><span title="[[true_name]]">[[true_name]]</span></th>\r\n                    [[/each]]\r\n                [[/compare]]\r\n                <td style="width:14px;"><a class="iconfont iconnext j-mr-action[[#if isNxtDisabled]] disable[[/if]][[#if hideOps]] f-dn[[/if]]" data-cal="1" href="javascript:;"></a></td>\r\n            </tr>\r\n            </tbody>\r\n        </table>\r\n        <div class="u-tg-container">\r\n            <div class="u-scroll-wrapper">\r\n                <table id="tgTable" class="tg-timedevents" cellpadding="0" cellspacing="0">\r\n                    <tbody>\r\n                    <tr height="1">\r\n                        <td style="width:64px;"></td>\r\n                        <td colspan="[[showList.length]]">\r\n                            <div class="tg-spanningwrapper">\r\n                                <div class="tg-hourmarkers">\r\n                                    <div class="tg-markercell"></div>\r\n                                    <div class="tg-markercell"></div>\r\n                                    <div class="tg-markercell"></div>\r\n                                    <div class="tg-markercell"></div>\r\n                                    <div class="tg-markercell"></div>\r\n                                    <div class="tg-markercell"></div>\r\n                                    <div class="tg-markercell"></div>\r\n                                    <div class="tg-markercell"></div>\r\n                                    <div class="tg-markercell"></div>\r\n                                    <div class="tg-markercell"></div>\r\n                                    <div class="tg-markercell"></div>\r\n                                    <div class="tg-markercell"></div>\r\n                                    <div class="tg-markercell"></div>\r\n                                    <div class="tg-markercell"></div>\r\n                                    <div class="tg-markercell"></div>\r\n                                    <div class="tg-markercell"></div>\r\n                                    <div class="tg-markercell"></div>\r\n                                    <div class="tg-markercell"></div>\r\n                                    <div class="tg-markercell"></div>\r\n                                    <div class="tg-markercell"></div>\r\n                                    <div class="tg-markercell"></div>\r\n                                    <div class="tg-markercell"></div>\r\n                                    <div class="tg-markercell"></div>\r\n                                    <div class="tg-markercell"></div>\r\n                                    <div class="tg-markercell"></div>\r\n                                </div>\r\n                            </div>\r\n                        </td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td class="tg-times-pri">\r\n                            <div class="tg-time-pri tg-time-pri-gmt">GMT+8</div>\r\n                            <div class="tg-time-pri"><span>00:00</span></div>\r\n                            <div class="tg-time-pri"><span>01:00</span></div>\r\n                            <div class="tg-time-pri"><span>02:00</span></div>\r\n                            <div class="tg-time-pri"><span>03:00</span></div>\r\n                            <div class="tg-time-pri"><span>04:00</span></div>\r\n                            <div class="tg-time-pri"><span>05:00</span></div>\r\n                            <div class="tg-time-pri"><span>06:00</span></div>\r\n                            <div class="tg-time-pri"><span>07:00</span></div>\r\n                            <div class="tg-time-pri"><span>08:00</span></div>\r\n                            <div class="tg-time-pri"><span>09:00</span></div>\r\n                            <div class="tg-time-pri"><span>10:00</span></div>\r\n                            <div class="tg-time-pri"><span>11:00</span></div>\r\n                            <div class="tg-time-pri"><span>12:00</span></div>\r\n                            <div class="tg-time-pri"><span>13:00</span></div>\r\n                            <div class="tg-time-pri"><span>14:00</span></div>\r\n                            <div class="tg-time-pri"><span>15:00</span></div>\r\n                            <div class="tg-time-pri"><span>16:00</span></div>\r\n                            <div class="tg-time-pri"><span>17:00</span></div>\r\n                            <div class="tg-time-pri"><span>18:00</span></div>\r\n                            <div class="tg-time-pri"><span>19:00</span></div>\r\n                            <div class="tg-time-pri"><span>20:00</span></div>\r\n                            <div class="tg-time-pri"><span>21:00</span></div>\r\n                            <div class="tg-time-pri"><span>22:00</span></div>\r\n                            <div class="tg-time-pri" style="border-bottom: 0;"><span>23:00</span></div>\r\n                        </td>\r\n                        [[#each showList]]\r\n                        <td class="tg-col">\r\n                            [[#if isEven]]\r\n                            <div class="tg-even"></div>\r\n                            [[/if]]\r\n\r\n                            [[#if events]]\r\n                                [[#each events]]\r\n                                <div class="tg-event-wrapper">\r\n                                    <div class="chip" style="top: [[top]]px;line-height: [[height]]px;" title="[[info]]"><span class="j-booker-name">[[name]] [[i18n \'calendar/piece_booked\']]</span></div>\r\n                                </div>\r\n                                [[/each]]\r\n                            [[/if]]\r\n                        </td>\r\n                        [[/each]]\r\n                    </tr>\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n        </div>\r\n    </script>\r\n    {{/raw}}\r\n\r\n</div>'}),define("component/meeetingRoombBookings",["require","jquery.ui/tooltip","jquery.datepicker","util/i18n!calendar","text!../../template/component/meetingroombookings.tpl.html","jquery","moment","../util/index","cui/ui/dialog/confirmbox","module/calendar/service","../module/common/globalService"],function(t){t("jquery.ui/tooltip"),t("jquery.datepicker"),t("util/i18n!calendar");var e=t("text!../../template/component/meetingroombookings.tpl.html"),i=t("jquery"),n=t("moment"),s=t("../util/index"),a=t("cui/ui/dialog/confirmbox"),r=t("module/calendar/service"),o=(t("../module/common/globalService"),a.extend({attrs:{width:"auto",title:s.i18n.t("calendar/ui_mr_bookings"),confirmTpl:s.i18n.t("common/confirm"),bookingsTip:"",mrList:[],cancelTpl:"",message:"",defaultDate:null,dnd:!0},events:{"click .j-set-today":"_handleSetToday","click .mr-item":"_handleUpdateMRList","click .j-cal-action":"_handleCalDate","click .j-mr-action":"_handleCalMR","change .cal-date-sel":"_renderMRBookingsView"},setup:function(){var t=this;this._params={mrList:[],showMRList:[],showIndex:0,showLength:4,bookingsStore:{},$selectedDate:null},this.set("message",this.compile(e)),o.superclass.setup.call(this),this.on("confirm",function(){t.hide()}),this.after("hide",function(){setTimeout(function(){t.trigger("close"),t.destroy()},20)})},render:function(){var t,e=this;o.superclass.render.call(this),t=e.attrs.defaultDate.value?e.attrs.defaultDate.value:n().format("YYYY-MM-DD"),e.$(".j-set-today").html(n().format("YYYY-MM-DD")),e._params.$selectedDate=e.$(".cal-date-sel").val(t).datepicker(),e.contentElement.find("[data-role=foot]").append('<div class="u-bookings-tip">'+e.attrs.bookingsTip.value+"</div>"),e.contentElement.tooltip(),0==e.attrs.mrList.value.length?i.when(r.getMRList()).then(function(t){i.each(t,function(t,e){e.id=t}),e._params.mrList=t,e._resetView()}):(i.each(e.attrs.mrList.value,function(t,e){e.id=t,e.selected=!0}),e._params.mrList=e.attrs.mrList.value,e._params.showMRList=e._params.mrList.concat(),e._resetView())},destroy:function(){o.superclass.destroy.call(this)},_resetView:function(){this._renderMRListView(),this._renderMRBookingsView()},_renderMRListView:function(){this.$(".j-mr-list").html(this.compile(this.$("#mrListTpl").html(),this._params.mrList))},_renderMRBookingsView:function(){var t=this;t._getCurrentBookingsData().then(function(e){t.$(".j-show-list").html(t.compile(t.$("#showMRListTpl").html(),e)),t.$(".u-scroll-wrapper").stop().animate({scrollTop:255},"500","swing"),i.each(t.$(".j-booker-name"),function(){var t=i(this),e=t.width(),n=t.closest(".chip").width();e>n&&t.css({fontSize:n/e+"em"})})})},_handleUpdateMRList:function(t){var e=this,n=i(t.target||t.srcElement);i.each(e._params.mrList,function(t,s){return s.id==n.data("id")?(s.selected=!n.hasClass("active"),s.selected?e._params.showMRList.push(s):i.each(e._params.showMRList,function(t,i){return i.id==n.data("id")?(e._params.showMRList.splice(t,1),!1):void 0}),!1):void 0}),e._resetView()},_handleCalDate:function(t){var e=i(t.target||t.srcElement);this._params.$selectedDate.val(n(this._params.$selectedDate.val()).add("days",e.data("cal")).format("YYYY-MM-DD")).datepicker("update"),this._params.$selectedDate.trigger("change")},_handleCalMR:function(t){var e=i(t.target||t.srcElement),n=this._params.showIndex,s=this._params.showMRList.length-4;s=0>s?0:s,n+=e.data("cal"),n=n>0?n:0,n=s>n?n:s,this._params.showIndex=n,this._renderMRBookingsView()},_handleSetToday:function(t){var e=i(t.target||t.srcElement);this._params.$selectedDate.val(e.text()).trigger("change").datepicker("update")},_getCurrentBookingsData:function(){function t(){if(c++,c==p||0==p){for(var t=0,e=d.length;e>t;t++)d[t].isEven=t%2?!0:!1;a.resolve({hideOps:4>=h,isPreDisabled:0==l,isNxtDisabled:l>=h-4,showList:d})}}function e(t){return i.each(t,function(t,e){var i=n(n(e[0]).diff(n(f+" 00:00:00"))>0?e[0]:f+" 00:00:00"),a=n(n(e[1]).diff(n(f+" 23:59:59"))<0?e[1]:f+" 23:59:59");e.top=parseInt(i.diff(n(f+" 00:00:00"))/36e5*30)+30,e.height=parseInt(a.diff(i)/36e5*30),e.name=e[2].match(/"?([^<]+?)"?\s*(?=<|@)/)[1],e.info=s.messageFormat.format(s.i18n.t("calendar/booking_hover_tip"),[i.format("HH:mm")+" - "+a.format("HH:mm"),e.name])}),t}var a=i.Deferred(),o=this,l=o._params.showIndex,d=o._params.showMRList.slice(l,l+4),c=0,p=d.length,h=o._params.showMRList.length,f=o._params.$selectedDate.val(),m=o._params.bookingsStore;return 0==p?t():(4>p&&h>=4&&(l=o._params.showIndex=h-4,d=o._params.showMRList.slice(l,l+4),p=4),i.each(d,function(i,n){m[n.id]=m[n.id]||{};var s=m[n.id][f];s?(n.events=s,t()):r.getMRBookings(n.email,f+" 0:00",f+" 23:59").then(function(i){m[n.id][f]=n.events=e(i),t()})})),a.promise()}}));return i.fn.mrbookings=function(t){return this.each(function(){var e,n=this,s=i.extend({trigger:n},i.fn.mrbookings.defaults,t);n.mrbookingsInstance||(e=new o(s),n.mrbookingsInstance=e)})},i.fn.mrbookings.defaults={parentNode:document.body,title:s.i18n.t("calendar/ui_mr_bookings"),defaultDate:null,bookingsTip:"",mrList:[],onSelect:i.noop,onClose:i.noop},o}),define("components/requirejs-text/text!template/module/calendar/index.tpl.html",[],function(){return'<section class="m-calendar j-calendar">\r\n  <div class="cal-main">\r\n  </div>\r\n\r\n  {{#raw}}\r\n  <!-- forbidden content template -->\r\n  <script type="x-handlebars-template" id="forbiddenTpl" data-container=".cal-main">\r\n    <div class="cal-forbidden">[[ i18n "pref/fa_forbidden" ]]</div>\r\n  </script>\r\n\r\n  <!-- content template -->\r\n  <script type="x-handlebars-template" id="contentTpl" data-container=".cal-main">\r\n    <aside class="fl-g-sidebar" style="overflow: hidden;">\r\n      <div class="asideArea" style="position: absolute;">\r\n        <div class="j-cal-cont cal-list-wrap">\r\n          <div class="cal-list-bg"></div>\r\n          <div class="u-to-up j-to-up u-unselectable u-disable" ><i class="iconfont iconup" ></i></div>\r\n          <div class="u-to-down j-to-down u-unselectable" ><i class="iconfont icondown" ></i></div>\r\n          <div class="content-box"></div>\r\n        </div>\r\n      </div>\r\n    </aside>\r\n    <article class="cal-g-content j-cal-content u-scroll" style="margin-left: 105px">\r\n      <div class="cal-content-bg"></div>\r\n      <div class="cal-content-wrap">\r\n        <iframe src="" frameborder="0" allowtransparency="true" name="calframe"></iframe>\r\n      </div>\r\n    </article>\r\n  </script>\r\n\r\n  <!-- cal folder tree template -->\r\n  <script type="x-handlebars-template" id="folderTreeTpl" data-container=".content-box">\r\n    <ul class="fl-m-nav">\r\n      [[#each this]]\r\n      <li class="j-cal-li">\r\n        <a href="javascript:void(0);" class="fl-m-nav-trigger j-cal-nav [[ this.className ]]" title="[[ this.title ]]"\r\n           data-fid="[[ this.fid ]]" data-type="[[ this.type ]]" data-linkuid="[[ this.linkUid ]]" data-query="[[ this.query ]]" >\r\n          <span><i class="iconfont [[this.icon]]"></i>[[formatCalTitle this.title ]]</span>\r\n        </a>\r\n      </li>\r\n      [[/each]]\r\n    </ul>\r\n  </script>\r\n  {{/raw}}\r\n\r\n</section>'}),define("module/calendar/index",["require","i18n!main,pref","jquery","../../widget/mask/mask","cui/core/view/view","cui/core/view/viewmanager","cui/util/templatable/templatable","util/messageformat","../../util/index","./service","module/common/globalService","component/meeetingRoombBookings","text!template/module/calendar/index.tpl.html"],function(t){t("i18n!main,pref");var e=t("jquery");t("../../widget/mask/mask");var i=t("cui/core/view/view"),n=t("cui/core/view/viewmanager"),s=t("cui/util/templatable/templatable"),a=t("util/messageformat"),r=t("../../util/index"),o=t("./service"),l=t("module/common/globalService"),d=t("component/meeetingRoombBookings"),c=i.extend({Implements:s,name:"calendar",attrs:{isPermit:{value:l.getConfig("calendar.enable"),readOnly:!0,getter:function(t){return t}}},defaultFid:l.getConfig("calendar.defaultfid"),folderType:{OWN:0,RECEIVED:1},navCurrentClassName:"fl-nav-current",templateHelpers:{formatCalTitle:function(t){return t.length>23?t.substring(0,23)+"...":t}},events:{"click .j-cal-nav":"_handleTrigger","mouseover .j-cal-cont":"_handleCalListOver","mouseout .j-cal-cont":"_handleCalListOut"},setup:function(){this._iframeSrc="cal/index.jsp?sid="+l.getSid(),this.activeFid=this.defaultFid,this.folderCache={},this.jspQueryCache="",this.state=l.getCurrentState(),this.state.param.newMeeting=this.state.param.newMeeting||!1,delete this.state.param.view,this.sendMessage("dispatcher","view:render",this.state)},render:function(){c.superclass.render.call(this),this._checkAuth(),e.notify.loading("hide")},destroy:function(){c.superclass.destroy.call(this),this._offModuleEvents()},_initModuleMessages:function(){var t=this;t.subscribe("setting.calendar.calendar","calUpdate",function(e){var i=e.message.fid,n=e.message.updateType;t._handleCalSettingUpdate(i,n)}),t.subscribe("dispatcher","locationChanged",function(i){var n=i.message,s=n.newState;"calendar"===s.module&&s.param.selectedDate&&(t._renderJSP(s.param),e.notify.loading("hide"))})},_initModuleEvents:function(){var t=this;e("body").off("cm.xt3.cal.forward").on("cm.xt3.cal.forward",function(i,n){return i.preventDefault(),e.isEmptyObject(n)?!1:(n=e.extend(!0,{},n),void t.sendMessage("dispatcher","history:add",{module:"mail.compose",param:{id:n.id}}))}).off("cm.xt3.cal.to.setting").on("cm.xt3.cal.to.setting",function(e){e.preventDefault(),t.sendMessage("dispatcher","history:add",{module:"setting.calendar.calendar",param:{historyUrl:encodeURIComponent("setting.calendar.calendar"),composeId:"calendar"}})}).off("cm.xt3.cal.set.time").on("cm.xt3.cal.set.time",function(i,n){i.preventDefault(),e.when(l.updateUser({first_week_day:parseInt(n)})).then(function(){t._renderJSP(),t._renderFolders(),e.notify(r.i18n.t("cal/info_update_success")),t.sendMessage("setting.calendar.calendar","view:refresh",{})})}).off("cm.xt3.cal.mr.bookings").on("cm.xt3.cal.mr.bookings",function(t,e){var i=new d(e);i.show()}),t._handleCalendarScroll()},_offModuleEvents:function(){e("body").off("cm.xt3.cal.forward").off("cm.xt3.cal.to.setting").off("cm.xt3.cal.set.time")},_checkAuth:function(){this.get("isPermit")?(this._initModuleMessages(),this._renderPage(),this._initModuleEvents()):this._renderForbidden()},_renderForbidden:function(){var t=this.$("#forbiddenTpl"),e=this.$(t.data("container")),i=t.html();e.html(this.compile(i,{}))},_renderPage:function(){var t,e=this,i=this.$("#contentTpl"),n=this.$(i.data("container"));t=e.compile(i.html()),n.html(t),this._renderFolders(),this._renderJSP()},_renderFolders:function(){var t,i=this,n=this.defaultFid,s=this.activeFid,l=this.folderType,d=[],c="",p=this.navCurrentClassName,h="iconsetschedule",f="iconmyschedule",m=e("#folderTreeTpl"),u=this.$(m.data("container"));d.push({fid:-1,title:r.i18n.t("cal/calendar_settings"),icon:h,className:-1==s?p:c}),d.push({fid:n,title:r.i18n.t("main/appname_MYCAL"),icon:f,className:s==n?p:c}),e.when(o.listCalFolder(),o.listAccessedCalFolder()).then(function(n,o){i.folderCache.ownCal="array"==e.type(n)?n:[],i.folderCache.receivedCal="array"==e.type(o)?o:[],e.each(n,function(t,e){var i="&fid="+e.fid;d.push({fid:e.fid,title:e.name,icon:f,className:s==e.fid?p:c,type:l.OWN,query:i})}),e.each(o,function(t,e){var i=a.format(r.i18n.t("main/cal_share_belong_to"),[e.link_uid.substring(0,e.link_uid.indexOf("@")),e.name]),n="&fid="+e.fid+"&linkUid="+e.link_uid;d.push({fid:e.fid,title:i,icon:f,className:s==e.fid?p:c,linkUid:e.link_uid,type:l.RECEIVED,query:n})}),i.calLength=d.length,t=i.compile(m.html(),d),u.html(t)})},_handleCalendarScroll:function(){var t=this,i=t.$(".asideArea"),n=i.find(".j-to-down"),s=i.find(".j-to-up"),a=i.height(),r=0;n.click(function(n){var o=i.find(".j-cal-li").eq(0).height(),l=a-t.calLength*o;if(n.preventDefault(),s.removeClass("u-disable"),!(l>=0)){if(parseInt(r)-o<=l)return i.css("top",l+"px"),void e(this).addClass("u-disable");r-=o,i.css("top",r+"px")}}),s.click(function(s){var a=i.find(".j-cal-li").eq(0).height();return s.preventDefault(),n.removeClass("u-disable"),0==parseInt(r)?void t.$(".asideArea").css("top","0px"):(r+=a,i.css("top",r+"px"),void(0==parseInt(r)&&e(this).addClass("u-disable")));
})},_handleCalListOver:function(){var t=this,e=t.$(".asideArea"),i=e.height(),n=e.find(".j-cal-li").eq(0).height(),s=i-t.calLength*n;0>s&&(e.find(".j-to-up").show(),e.find(".j-to-down").show())},_handleCalListOut:function(){var t=this,e=t.$(".asideArea");e.find(".j-to-up").hide(),e.find(".j-to-down").hide()},_renderJSP:function(t){var i=this.$(".j-cal-content"),n=i.find("iframe").eq(0),s=this._iframeSrc;"undefined"!=typeof t&&(this.jspQueryCache=t),"string"!=e.type(this.jspQueryCache)&&(this.activeFid=this.defaultFid,this.jspQueryCache=""),s+=this.jspQueryCache,this.state.param.newMeeting&&(s="cal/eventEdit.jsp?sid="+l.getSid(),this.state.param.newMeeting=!1),i.mask(),n.off("load").attr("src",s).load(function(){i.mask("destroy")})},_handleTrigger:function(t){var i,n=this,s=e(t.currentTarget),a=s.data("fid");return t.preventDefault(),-1==a?void n.sendMessage("dispatcher","history:add",{module:"setting.calendar.calendar",param:{}}):void(s.hasClass(this.navCurrentClassName)||(i=s.parent().parent(),i.find(".j-cal-nav").removeClass(this.navCurrentClassName),s.addClass("fl-nav-current"),this.activeFid=a,this._renderJSP(s.data("query"))))},_handleCalSettingUpdate:function(t,e){switch(e){case"UPDATE":t==this.activeFid&&this._renderJSP(),this._renderFolders();break;case"UPDATE_ALL":this._renderJSP(),this._renderFolders();break;case"DELETE":t==this.activeFid&&(this.activeFid=this.defaultFid,this._renderJSP("")),this._renderFolders();break;case"CREATE":this._renderFolders()}}});n.module({name:"calendar",template:t("text!template/module/calendar/index.tpl.html")},c)});
//# sourceMappingURL=index.js.map