define("components/requirejs-text/text!template/module/file/accessory.tpl.html",[],function(){return'<div class="mfl-wrapper">\r\n  <div class="main-wrapper mfl-acc-main">\r\n    <!-- M锛氬伐鍏锋爮 -->\r\n    <aside class="mfl-toolbar"></aside>\r\n\r\n    <!-- 鏂囦欢鍒楄〃 -->\r\n    <section class="mfl-acc-wrap jfl-acc-wrap u-scroll"></section>\r\n  </div>\r\n\r\n  {{#raw}}\r\n  <script type="x-handlebars-template" id="toolbarTpl" data-container=".mfl-toolbar">\r\n\r\n    <!-- C锛氭枃浠剁被鍨嬬瓫閫� -->\r\n    <div class="u-btns jfl-toolbar-filter-type">\r\n        <span class="u-btn u-btn-default" data-dropdown="switchSort">\r\n          <span class="btntxt">[[ i18n "common/op_view" ]]</span>\r\n          <i class="iconfont icondown"></i>\r\n        </span>\r\n    </div>\r\n\r\n    <!-- C锛氭壒閲忔搷浣滐細涓嬭浇銆佸彂閫併€佷繚瀛樺埌涓汉缃戠洏 -->\r\n    <div class="u-input-control jfl-toolbar-batch">\r\n      <div class="u-btns">\r\n        [[#if permitDownloadPackage]]\r\n        <button class="u-btn u-btn-default" data-batchAction="download">[[ i18n "common/download" ]]</button>\r\n        [[/if]]\r\n        [[#if permitSendMail]]\r\n        <button class="u-btn u-btn-default" data-batchAction="send">[[ i18n "common/send" ]]</button>\r\n        [[/if]]\r\n        <a data-href="../s?sid=[[sid]]&func=mbox%3apackMessage" target="_blank" class="f-dn jfl-download-fake"></a>\r\n      </div>\r\n      [[#if permitSaveToNF]]\r\n      <button class="u-btn u-btn-default" data-batchAction="toNF">[[ i18n "common/op_to_netfolder" ]]</button>\r\n      [[/if]]\r\n      [[#if permitSaveToXNF]]\r\n      <button class="u-btn u-btn-default" data-batchAction="toXNF">[[ i18n "common/op_to_xnffolder" ]]</button>\r\n      [[/if]]\r\n    </div>\r\n\r\n    <!-- C锛氬垪琛ㄦā寮忓垏鎹� -->\r\n    <div class="u-btns mfl-toolbar-togglemode jfl-toolbar-togglemode">\r\n      <button class="u-btn u-btn-default" data-mode="thumbnail" title="[[i18n \'nf/view_thumbnail\']]"><i class="iconfont iconblock"></i></button>\r\n      <button class="u-btn u-btn-default" data-mode="detail" title="[[i18n \'nf/view_detail\']]"><i class="iconfont iconlist"></i></button>\r\n    </div>\r\n\r\n    <!-- C锛氭枃浠跺悕绛涢€� -->\r\n    <div class="mfl-toolbar-filter-name jfl-toolbar-filter-name u-input-control left">\r\n      <span class="iconfont iconsreachm" data-action="startSearch"></span>\r\n      <input type="text" class="u-input" placeholder >\r\n    </div>\r\n\r\n    <!-- C锛氬垎椤垫帶浠� -->\r\n    <div class="mfl-toolbar-pagination jfl-toolbar-pagination"></div>\r\n  </script>\r\n\r\n  <script type="x-handlebars-template" id="skipFolderTipsTpl">\r\n    [[! 浠呭綋鏈夋枃浠跺す琚畨鍏ㄩ攣閿佸畾锛屽悓鏃跺畨鍏ㄩ攣娌¤楠岃瘉鐨勬儏鍐典笅锛屽嚭鐜伴《閮ㄦ彁绀烘秷鎭� ]]\r\n    <div class="u-alert u-alert-warning">\r\n      <strong><i class="iconfont iconring"></i></strong>\r\n      [[ i18n "file/msg_att_mgr_skip_locked" ]]\r\n      <a href="javascript:void(0);" class="link" data-accAction="toUserAuth2">[[ i18n "file/msg_att_mgr_auth2_do" ]]</a>\r\n    </div>\r\n  </script>\r\n\r\n  <!-- 鏂囦欢鍒楄〃Detail 妯″紡 -->\r\n  <script type="x-handlebars-template" id="detailListTpl">\r\n    <div class="mfl-acc-list">\r\n      <div class="mfl-acc-listhead">\r\n        <table class="u-table u-table-row">\r\n          <thead>\r\n          <tr>\r\n            [[#if lists]]\r\n              <th class="col-chk">\r\n                <span>\r\n                  <input type="checkbox" class="u-input" name="chargeOther" />\r\n                </span>\r\n                &nbsp;\r\n                <a href="javascript:void(0);" data-order="attn">[[ i18n "file/lbl_accessory_dealings" ]]</a>\r\n                [[GetSortTypeIcon \'attn\' sort.order sort.desc ]]\r\n              </th>\r\n              [[#if enableSecurityLevel]]\r\n              <th class="col-securityLevel">\r\n                [[ i18n "common/lbl_attach_level" ]]\r\n              </th>\r\n              [[/if]]\r\n              <th class="col-size">\r\n                <a href="javascript:void(0);" data-order="attsize">[[ i18n "file/lbl_email_size" ]]</a>\r\n                [[GetSortTypeIcon \'attsize\' sort.order sort.desc ]]\r\n              </th>\r\n              <th class="col-date">\r\n                <a href="javascript:void(0);" data-order="date">[[ i18n "file/lbl_email_date" ]]</a>\r\n                [[GetSortTypeIcon \'date\' sort.order sort.desc ]]\r\n              </th>\r\n              <th class="col-subject">\r\n                <a href="javascript:void(0);" data-order="subject">[[ i18n "file/lbl_email_subject" ]]</a>\r\n                [[GetSortTypeIcon \'subject\' sort.order sort.desc ]]\r\n              </th>\r\n              <th class="col-from">\r\n                <a href="javascript:void(0);" data-order="from">[[ i18n "file/lbl_email_send" ]]</a>\r\n                [[GetSortTypeIcon \'from\' sort.order sort.desc ]]\r\n              </th>\r\n            [[else]]\r\n              <th class="col-chk">[[ i18n "file/lbl_accessory_dealings" ]]</th>\r\n              [[#if enableSecurityLevel]]\r\n              <th class="col-securityLevel">[[ i18n "common/lbl_attach_level" ]]</th>\r\n              [[/if]]\r\n              <th class="col-size">[[ i18n "file/lbl_email_size" ]]</th>\r\n              <th class="col-date">[[ i18n "file/lbl_email_date" ]]</th>\r\n              <th class="col-subject">[[ i18n "file/lbl_email_subject" ]]</th>\r\n              <th class="col-from">[[ i18n "file/lbl_email_send" ]]</th>\r\n            [[/if]]\r\n          </tr>\r\n          </thead>\r\n        </table>\r\n      </div>\r\n      <div class="mfl-acc-lists mfl-acc-details jfl-acc-lists">\r\n        [[#if lists]]\r\n        <table class="u-table u-table-row">\r\n          <tbody>\r\n          [[#each lists]]\r\n          <tr class="mfl-acc-item"\r\n              data-accid="[[ this.id ]]"\r\n              data-accpartid="[[ this.partId ]]"\r\n              data-type="internal"\r\n              data-contenttype="[[ this.attt ]]"\r\n              data-size="[[ this.attsize ]]"\r\n              data-name="[[ this.attn ]]">\r\n\r\n            <td class="col-chk">\r\n                <span>\r\n                  <input type="checkbox" class="u-input j-item-chk" />\r\n                </span>\r\n            </td>\r\n\r\n            <td class="col-name">\r\n              <i class="file-small-icon [[ GetFileIco this.attn \'icon-small-\' ]]"></i>\r\n              [[#if this.attn]]\r\n              <span title="[[ this.attn ]]">[[ this.attn ]]</span>\r\n              [[else]]\r\n              <span>&nbsp;</span>\r\n              [[/if]]\r\n            </td>\r\n            <td class="col-tool">\r\n              <span class="item-toolbar">\r\n                [[! 浠�3 涓猙tn 涓哄垎鐣岀嚎锛屽浜庝笁涓紝鍒欏彧鏄剧ず鍓嶄袱涓拰鏇村锛屽墿浣欑殑popup 鏄剧ず ]]\r\n                [[#compare toolbarLength \'<=\' 3]]\r\n                  [[#each toolbarMeta]]\r\n                    <a href="[[ this.href ]]" target="[[this.target]]" data-accAction="[[this.action]]" title="[[ this.title ]]"><i class="iconfont [[this.icon]]"></i></a>\r\n                  [[/each]]\r\n                [[^]]\r\n                  [[#each toolbarMeta]]\r\n                    [[#compare @index \'<\' 2]]\r\n                      <a href="[[ this.href ]]" target="[[this.target]]" data-accAction="[[this.action]]" title="[[ this.title ]]"><i class="iconfont [[this.icon]]"></i></a>\r\n                    [[^]]\r\n                      [[! 杩欓噷鐨刪tml 缁撴瀯涓轰簡鏂逛究缁檍s 涓殑handleShowMore 鍋氭ā鏉挎嫾鎺� ]]\r\n                      <span class="f-dni j-hidden-tool">\r\n                        <i class="iconfont [[ this.icon ]] left"></i>\r\n                        <a href="[[ this.href ]]" target="[[ this.target ]]" data-action="[[ this.action ]]" title="[[ this.title ]]" >[[ this.title ]]</a>\r\n                      </span>\r\n                    [[/compare]]\r\n                  [[/each]]\r\n                  <a href="javascript:void(0);" data-accAction="more" title="[[ i18n \'common/more\' ]]"><i class="iconfont iconsliderh"></i></a>\r\n                [[/compare]]\r\n              </span>\r\n            </td>\r\n            [[! 涓嬮潰姣忎釜瀛楁閮借鏈変釜榛樿鐨勫€硷紙&nbsp;锛夛紝闃叉鍑虹幇琛ㄦ牸闂儊 ]]\r\n            [[#if ../../enableSecurityLevel]]\r\n            <td class="col-securityLevel">\r\n              [[ DepartSLFromFilename this.attn ]]\r\n            </td>\r\n            [[/if]]\r\n            <td class="col-size">\r\n              [[#if this.attsize ]]\r\n                [[ GetFileFriendlySize this.attsize ]]\r\n              [[else]]\r\n                &nbsp;\r\n              [[/if]]\r\n            </td>\r\n            <td class="col-date">\r\n              [[#if this.sentDate ]]\r\n                [[GetDateYMDHm this.sentDate ]]\r\n              [[else]]\r\n                &nbsp;\r\n              [[/if]]\r\n            </td>\r\n            <td class="col-subject" title="[[ this.subject ]]">\r\n              [[#if this.subject ]]\r\n                [[ this.subject ]]\r\n              [[else]]\r\n                &nbsp;\r\n              [[/if]]\r\n            </td>\r\n            <td class="col-from" title="[[ this.from ]]">\r\n              [[#if this.from ]]\r\n                [[ GetFileFrom this.from]]\r\n              [[else]]\r\n                &nbsp;\r\n              [[/if]]\r\n            </td>\r\n          </tr>\r\n          [[/each]]\r\n          </tbody>\r\n        </table>\r\n        [[else]]\r\n          [[[ i18n "file/msg_list_att_blank" ]]]\r\n        [[/if]]\r\n      </div>\r\n    </div>\r\n  </script>\r\n\r\n  <!-- 鏂囦欢鍒楄〃澶у浘妯″紡 -->\r\n  <script type="x-handlebars-template" id="thumbnailListTpl">\r\n    <div class="mfl-acc-list">\r\n      <div class="mfl-acc-listhead">\r\n        <div class="list-title">\r\n          [[#if lists]] [[! 濡傛灉鍒楄〃涓虹┖锛岄殣钘忓叏閫夋帶浠讹紝閬垮厤鍕鹃€夊悗鍑虹幇鎵归噺鎿嶄綔toolbar ]]\r\n                <span>\r\n                  <input type="checkbox" class="u-input" name="chargeOther" />\r\n                </span>\r\n          &nbsp;\r\n          [[/if]]\r\n          [[ i18n "file/lbl_accessory_dealings" ]]\r\n        </div>\r\n      </div>\r\n      <div class="mfl-acc-lists mfl-acc-tns jfl-acc-lists">\r\n        [[#if lists]]\r\n        <ul class="mfl-acc-tns-main">\r\n          [[#each lists]]\r\n          <li class="mfl-acc-item"\r\n              data-accid="[[ this.id ]]"\r\n              data-accpartid="[[ this.partId ]]"\r\n              data-contenttype="[[ this.contentType ]]"\r\n              data-size="[[ this.attsize ]]"\r\n              data-name="[[ this.attn ]]">\r\n\r\n            <span class="tn-ico file-big-icon [[ GetFileIco this.attn \'icon-big-\' ]]"></span>\r\n            <span class="tn-title">[[ this.attn ]]</span>\r\n            <span class="tn-chk">\r\n                  <input type="checkbox" class="u-input j-item-chk" />\r\n            </span>\r\n            <span class="item-toolbar">\r\n              <span class="mask"></span>\r\n              [[! 浠�2 涓猙tn 涓哄垎鐣岀嚎锛屽皬浜庢垨绛変簬2涓紝闇€瑕佸湪鍓嶅悗濉厖绌哄厓绱狅紝閬垮厤璁╃晫闈㈣繃浜庨毦鐪� ]]\r\n              [[#compare this.toolbarLength "<=" 2]]\r\n              <span>&nbsp;</span>\r\n              [[#each toolbarMeta]]\r\n                <a href="[[ this.href ]]" target="[[this.target]]" data-accAction="[[this.action]]" title="[[ this.title ]]"><i class="iconfont [[this.icon]]"></i></a>\r\n              [[/each]]\r\n              <span>&nbsp;</span>\r\n              [[^]]\r\n              [[#each toolbarMeta]]\r\n                <a href="[[ this.href ]]" target="[[this.target]]" data-accAction="[[this.action]]" title="[[ this.title ]]"><i class="iconfont [[this.icon]]"></i></a>\r\n              [[/each]]\r\n              [[/compare]]\r\n              <!-- 浠ヤ笅杩欎釜鍏冪礌涓嶈兘鍘婚櫎锛屼负浜嗗舰鎴愯鍐呭厓绱犲钩鍧囧垎甯冪殑鏁堟灉 -->\r\n              <span class="left-fix"></span>\r\n            </span>\r\n          </li>\r\n          [[/each]]\r\n        </ul>\r\n        [[else]]\r\n          [[[ i18n "file/msg_list_att_blank" ]]]\r\n        [[/if]]\r\n      </div>\r\n    </div>\r\n  </script>\r\n  {{/raw}}\r\n</div>'}),define("module/file/accessory/index",["require","i18n!main,file,common,mbox","jquery","moment","handlebars","xss","cui/core/view/view","cui/core/view/viewmanager","cui/util/templatable/templatable","cui/ui/tip/tip","../../../widget/mask/mask","../../../widget/pagination/pagination","../../../util/index","module/common/globalService","../fileService","module/mail/service","module/common/previewCtrl","../../../configurable/index","../../../util/size","../../../util/file","../../../component/userauth2","../../../component/filetonfbox","../../../component/xnffilebox","text!template/module/file/accessory.tpl.html"],function(e){function t(e,t){return u.checkFilePermit(e,t)}e("i18n!main,file,common,mbox");var n=e("jquery"),i=e("moment"),a=e("handlebars"),r=e("xss"),l=e("cui/core/view/view"),s=e("cui/core/view/viewmanager"),o=e("cui/util/templatable/templatable"),c=e("cui/ui/tip/tip");e("../../../widget/mask/mask"),e("../../../widget/pagination/pagination");var d=e("../../../util/index"),f=e("module/common/globalService"),h=e("../fileService"),m=e("module/mail/service"),u=e("module/common/previewCtrl"),p=e("../../../configurable/index"),v=e("../../../util/size"),b=e("../../../util/file"),g=e("../../../component/userauth2"),_=e("../../../component/filetonfbox"),w=e("../../../component/xnffilebox"),x=l.extend({Implements:o,name:"file.accessory",title:d.i18n.t("file/lbl_accessory_dealings"),state:null,attrs:{sort:{order:"date",desc:"true"},filter:{attn:"",attType:""},listMode:{current:"detail",detail:{pageLimit:20},thumbnail:{pageLimit:20}},pageEntity:{total:0,limit:0,current:0},selectedFiles:{length:0,max:0,files:{}},permit:{download:!0,preview:!0,saveToNF:!0,saveToXNF:!1,downloadPackage:!0,sendMail:!0,securityLevel:!1},supportPreviewTypes:null},widgets:{fileToNfBox:null,fileToXNfBox:null},events:{'click [data-accAction="toUserAuth2"]':"_handleUserAuth2",'click [data-accAction="more"]':"_handleShowMore",'click .mfl-acc-item [data-accAction="savenf"]':"_handleOnceToNF",'click .mfl-acc-item [data-accAction="savexnf"]':"_handleOnceToXNF",'click .mfl-acc-item [data-accAction="toCompose"]':"_handleOnceSend","click .mfl-acc-item i.checkbox":"_handleListChkItemClick","click .mfl-acc-listhead i.checkbox":"_handleListChkAllClick",'click .sidepanel [data-accAction="closePanel"]':"_handleCancelToNF",'click .sidepanel [data-accAction="confirmNF"]':"_handleConfirmToNF"},setup:function(){this.state=f.getCurrentState(),delete this.state.param.view},render:function(){x.superclass.render.call(this);var e=p("file.accessory");return e.enableAtt?(this.set("permit",{download:e.download,preview:e.preview,saveToNF:e.saveToNF,downloadPackage:e.downloadPackage,saveToXNF:e.saveToXNF,sendMail:e.sendMail,securityLevel:e.securityLevel}),this.set("supportPreviewTypes",f.getConfig("mail.supportedpreviewtypes")),this._renderToolbar(),this._initList(),this._initModuleSubEvent(),this.widgets.nfTree=_,void n.notify.loading("hide")):(this.element.html(d.i18n.t("file/msg_att_mgr_forbid")),n.notify.loading("hide"),!1)},destroy:function(){!!this.widgets.fileToNfBox&&this.widgets.fileToNfBox.destroy(),this.widgets.fileToNfBox=null,x.superclass.destroy.call(this)},_initModuleSubEvent:function(){var e=this;this.subscribe("component.userauth2","auth2Unlocked",function(){e._initList()})},_renderToolbar:function(){var e,t,n=this.$("#toolbarTpl"),i=this.$(n.attr("data-container"));return i.length<=0?!1:(t={sid:f.getSid(),permitSaveToNF:this.get("permit").saveToNF,permitDownloadPackage:this.get("permit").downloadPackage,permitSaveToXNF:this.get("permit").saveToXNF,permitSendMail:this.get("permit").sendMail},e=this.compile(n.html(),t),i.html(e),this.$toolbarWrap=i,this._initToolAttnFilter(i.find(".jfl-toolbar-filter-name")),this._initToolAttTypeFilter(i.find(".jfl-toolbar-filter-type")),this._initToolBatch(i.find(".jfl-toolbar-batch"),!0),void this._initToolListMode(i.find(".jfl-toolbar-togglemode")))},_renderList:function(e,i){var a,r,l,s,o,c=this,f=c.get("permit"),h=c.get("listMode"),m=function(e){return!n.isPlainObject(e)&&(e={}),{href:e.href||"javascript:void(0);",target:e.target||"",title:e.title||"",icon:e.icon||"",action:e.action||""}};if(a=c.$("#"+h.current+"ListTpl"),!e||e.length<=0)return!1;for(!i&&(i=[]),l=0;l<i.length;l++)s=i[l],s.allowDownloadAttachment=f.download,s.allowPreview=f.preview&&t(s.attn,s.attsize),s.allowAddToNetfolder=f.saveToNF,s.allowAddToXNF=f.saveToXNF,s.allowSendMail=f.sendMail,o=[],s.allowDownloadAttachment&&o.push(m({href:c.templateHelpers.GetDownloadUrl(s.id,s.partId),title:d.i18n.t("common/download"),icon:"icondownload",target:"_blank"})),s.allowPreview&&o.push(m({href:c.templateHelpers.GetPreviewUrl(s.id,s.partId),title:d.i18n.t("common/op_preview"),icon:"iconeye",target:"_blank"})),s.allowSendMail&&o.push(m({title:d.i18n.t("common/send"),icon:"iconemail",action:"toCompose"})),s.allowAddToNetfolder&&o.push(m({title:d.i18n.t("common/op_to_netfolder"),icon:"iconsave",action:"savenf"})),s.allowAddToXNF&&o.push(m({title:d.i18n.t("common/op_to_xnffolder"),icon:"iconyin",action:"savexnf"})),s.toolbarMeta=[].concat(o),s.toolbarLength=n.isArray(s.toolbarMeta)?s.toolbarMeta.length:0;r=n(c.compile(a.html(),{lists:i,sort:c.get("sort"),enableSecurityLevel:f.securityLevel})).customRadioCheckbox(),e.append(r),"detail"===h.current&&r.on("click",".mfl-acc-listhead .u-table th a",n.proxy(c._handleSortChange,c))},_initList:function(e){var t=this,i=this.$(".jfl-acc-wrap"),a=this.get("pageEntity"),r=this.get("listMode"),l=e?{current:a.current,limit:a.limit}:{current:0,limit:r[r.current].pageLimit};return!i||i.length<=0?!1:(i.empty(),this._initAuth2UnlockTips(i),void this._fetchAccData(l,function(n){e||t.set("pageEntity",{total:n.total,limit:l.limit,current:0}),t.set("selectedFiles",{length:0,max:n["var"].length,files:{}},{override:!0}),t._renderList(i,n["var"])},function(){n.notify.error(d.i18n.t("file/msg_list_att_fail"))}))},_initToolAttnFilter:function(e){var t,i=this;return!e||e.length<=0?!1:(t=e.find('input[type="text"]'),t.val("").attr("placeholder",d.i18n.t("file/msg_search",{name:i.title})),e.on("keyup",n.proxy(i._handleFilterAttnKeyUp,i)),void e.on("click",'[data-action="startSearch"]',n.proxy(i._handleFilterAttnSubmit,i)))},_initToolAttTypeFilter:function(e){var t=this,n=f.getConfig("file.attsort");return!e||e.length<=0?!1:void(n.length<=0?e.remove():e.dropdown({data:n,callback:function(e){!e.value&&(e.value=""),t.set("filter",{attType:e.value})}}))},_initToolBatch:function(){var e;return function(t,n){if(t&&t.length>0)e=t;else if(!e)return!1;n&&(this._initToolBatchDownload(e.find('[data-batchAction="download"]')),this._initToolBatchSend(e.find('[data-batchAction="send"]')),this._initToolBatchToNF(e.find('[data-batchAction="toNF"]')),this._initToolBatchToXNF(e.find('[data-batchAction="toXNF"]'))),this.get("selectedFiles").length&&this.get("selectedFiles").length>0?e.removeClass("f-dn"):e.addClass("f-dn")}}(),_initToolListMode:function(e){var t,i=this;return!e||e.length<=0?!1:(t=this.get("listMode").current,e.find('button[data-mode="'+t+'"]').addClass("disabled"),void e.on("click","button",n.proxy(i._handleListModeChange,i)))},_initToolPagination:function(e){var t=this;if(!e||e.length<=0)return!1;var n=this.get("pageEntity");n.total||(n.total=1),("number"!=typeof n.current||n.current<0)&&(n.current=0),e.children().remove().end().pagination({total:n.total,limit:n.limit,currentPage:n.current,round:!0,prevText:'<span class="iconfont iconprevious"></span>',nextText:'<span class="iconfont iconnext"></span>',callback:function(e){t._handlePageCurrentChange(e)}})},_initToolBatchDownload:function(e){var t=this;return!e||e.length<=0?!1:void e.off("click").on("click",n.proxy(t._handleBatchDownload,t))},_initToolBatchSend:function(e){var t=this;return!e||e.length<=0?!1:void e.off("click").on("click",n.proxy(t._handleBatchSend,t))},_initToolBatchToNF:function(e){var t=this;return!e||e.length<=0?!1:void e.off("click").on("click",n.proxy(t._handleBatchToNF,t))},_initToolBatchToXNF:function(e){var t=this;return!e||e.length<=0?!1:void e.off("click").on("click",n.proxy(t._handleBatchToXNF,t))},_initAuth2UnlockTips:function(e){var t,i,a=this,r=f.getFolderLockedStatus();return!e||e.length<=0?!1:void(r.isAuth||(t=this.$("#skipFolderTipsTpl"),i=n(a.compile(t.html())),e.append(i)))},_onChangeFilter:function(){this._initList()},_onChangeSort:function(){this._initList()},_onChangeSelectedFiles:function(){this._initToolBatch()},_onChangePageEntity:function(){this._initToolPagination(this.$toolbarWrap.find(".jfl-toolbar-pagination"))},_onChangeListMode:function(){this._initList()},_handleFilterAttnKeyUp:function(e){var t=n(e.currentTarget).find(".u-input"),i=r(n.trim(t.val()));e.preventDefault(),13===e.which&&this.set("filter",{attn:i})},_handleFilterAttnSubmit:function(e){var t=n(e.target).parent().find('[type="text"]'),i=r(n.trim(t.val()));e.preventDefault(),this.set("filter",{attn:i})},_handleSortChange:function(e){var t,i=n(e.target),a=i.data("order"),r=this.get("sort");t=r.order===a?!r.desc:"date"===a,this.set("sort",{order:a,desc:t})},_handlePageCurrentChange:function(e){this.set("pageEntity",{current:e},{silent:!0}),this._initList(!0)},_handleListModeChange:function(e){var t=n(e.currentTarget),i=t.attr("data-mode"),a=t.parent();return e.preventDefault(),t.hasClass("disabled")?!1:i&&i!=this.get("listMode").current?(a.children().removeClass("disabled"),t.addClass("disabled"),void this.set("listMode",{current:i})):!1},_handleOnceSend:function(e){var t=n(e.target).parents(".mfl-acc-item"),i=t.data("accid"),a=t.data("accpartid");e.preventDefault(),this._switchToCompose([i+"/"+a])},_handleOnceToNF:function(e){var t=n(e.target).parents(".mfl-acc-item"),i=t.data("accid"),a=t.data("accpartid");e.preventDefault(),this.set("toNFParts",[i+"/"+a]),this.widgets.fileToNfBox=new _({files:this.get("toNFParts")}).show()},_handleOnceToXNF:function(e){var t=n(e.target).parents(".mfl-acc-item"),i=t.data("accid"),a=t.data("accpartid");e.preventDefault(),this.set("toNFParts",[i+"/"+a]),this.widgets.fileToXNfBox=w.saveFilesToXNF(this.get("toNFParts"),n.noop,n.noop).show()},_handleUserAuth2:function(e){e.preventDefault(),g.box({})},_handleShowMore:function(e,t){var i=this,a=this.get("permit"),r=n(t).closest(".item-toolbar"),l=function(t){var a=n(t.target).data("action");switch(i.widgets.uTip.hide(),a){case"toCompose":t.preventDefault(),i._handleOnceSend(e);break;case"savenf":t.preventDefault(),i._handleOnceToNF(e);break;case"savexnf":t.preventDefault(),i._handleOnceToXNF(e)}},s='<ul class="u-menu mfl-acc-submenu">';r.find("span.j-hidden-tool").each(function(){s+="<li>"+n(this).html()+"</li>"}),s+="</ul>",e.preventDefault(),this.widgets.uTip&&this.widgets.uTip.destroy(),this.widgets.uTip=new c({trigger:t,triggerType:"click",content:i.compile(s,{allowAddToNetfolder:a.saveToNF,allowAddToXNF:a.saveToXNF}),arrowPosition:1,effect:"fade"}),this.widgets.uTip.before("show",function(){this.$('[data-role="content"]').off("click",l).on("click",l)}).after("hide",function(){this.$('[data-role="content"]').off("click",l),this.destroy()}),t._active=!0,this.widgets.uTip.show()},_handleBatchDownload:function(e){var t,i,a=this.get("selectedFiles"),r=n(e.target).siblings("a.jfl-download-fake"),l="";e.preventDefault(),n.each(a.files,function(e,n){t=n.id,i=n.partid,l+="&part="+t+"/"+i}),r.attr("href",r.attr("data-href")+l),r[0].click()},_handleBatchSend:function(e){var t=this.get("selectedFiles"),n=[],i=t.files;e.preventDefault(),Object.keys(i).forEach(function(e){n.unshift(i[e].id+"/"+i[e].partid)}),this._switchToCompose(n)},_handleBatchToNF:function(e){var t,i,a=this.get("selectedFiles"),r=[];e.preventDefault(),n.each(a.files,function(e,n){t=n.id,i=n.partid,r.unshift(t+"/"+i)}),this.set("toNFParts",r),this.widgets.fileToNfBox=new _({files:r}).show()},_handleBatchToXNF:function(e){var t,i,a=this.get("selectedFiles"),r=[];e.preventDefault(),n.each(a.files,function(e,n){t=n.id,i=n.partid,r.unshift(t+"/"+i)}),this.set("toNFParts",r),this.widgets.fileToXNfBox=w.saveFilesToXNF(r).show()},_handleListChkAllClick:function(e,t){var i=this,a=n(t),r=a.hasClass("checkbox-checked"),l=a.parents(".mfl-acc-list").find(".mfl-acc-item");l.each(function(e){r?!l.eq(e).hasClass("checked")&&i._selectItem(l.eq(e),!0):l.eq(e).hasClass("checked")&&i._unSelectItem(l.eq(e),!0)}),this._initToolBatch()},_handleListChkItemClick:function(e,t){var i,a=n(t),r=a.parents(".mfl-acc-list").find(".mfl-acc-listhead i.checkbox"),l="checkbox-checked",s=a.hasClass(l),o=a.parents(".mfl-acc-item");s?this._selectItem(o):this._unSelectItem(o),i=this.get("selectedFiles"),i.length>=i.max?r.addClass(l):r.removeClass(l)},_fetchAccData:function(e,t,i){var a=this.get("filter"),r=this.get("sort");"securityLevel"===r.order&&(r.order="attn"),n.when(h.getAccListConditional({start:e.current*e.limit,limit:e.limit,returnTotal:!0,order:r.order,filter:a,desc:r.desc})).then(t,i)},_selectItem:function(e,t){var n,i,a,r,l,s,o;return!e||e.length<=0?!1:(e.addClass("checked"),o=e.find("i.checkbox"),!o.hasClass("checkbox-checked")&&o.addClass("checkbox-checked"),n=e.data("accid"),i=e.data("accpartid"),a=e.data("contenttype"),r=e.data("name"),l=e.data("size"),s=this.get("selectedFiles"),s.files[n+"_"+i]={id:n,partid:i,contenttype:a,name:r,size:l},void this.set("selectedFiles",{length:++s.length},{silent:!!t}))},_unSelectItem:function(e,t){var n,i,a,r;return!e||e.length<=0?!1:(e.removeClass("checked"),r=e.find("i.checkbox"),r.hasClass("checkbox-checked")&&r.removeClass("checkbox-checked"),n=e.data("accid"),i=e.data("accpartid"),a=this.get("selectedFiles"),void(a.files[n+"_"+i]&&(delete a.files[n+"_"+i],this.set("selectedFiles",{length:--a.length},{silent:!!t}))))},_switchToCompose:function(e){var t=this;m.getComposeInfo({ctype:"attach_part",part:e}).then(function(e){t.sendMessage("dispatcher","history:add",{module:"mail.compose",param:{id:e.id}})})},templateHelpers:{GetDateYMDHm:function(e){return e?new a.SafeString(i(e).format("YYYY-MM-DD HH:mm")):void 0},GetFileFriendlySize:function(e){return!e||0>e?"0K":v.bytesToSize(e,0)},GetFileIco:function(e,t){return e&&t?t+b.formatFileType(e):""},GetDownloadUrl:function(e,t){return e&&t?"mbox/readdata.jsp?sid="+f.getSid()+"&mboxa=&part="+t+"&mid="+encodeURIComponent(e)+"&mode=download":""},GetPreviewUrl:function(e,t){return e&&t?"mbox/readdata.jsp?sid="+f.getSid()+"&mboxa=&part="+t+"&mid="+encodeURIComponent(e)+"&mode=preview":""},GetFileFrom:function(e){var t,n=/^"?(.+)" </;return e?(t=n.exec(e),t=t?t[1]:e):""},GetSortTypeIcon:function(e,t,n){var i;return i=e&&t&&t===e?n?'<i class="iconfont iconmovedown"></i>':'<i class="iconfont iconmoveup"></i>':"",new a.SafeString(i)},DepartSLFromFilename:function(e){return d.securityLevel.departSLFromFilename(e)}}});s.module({name:"file.accessory",template:e("text!template/module/file/accessory.tpl.html")},x)}),define("components/requirejs-text/text!component/../../template/component/nfShareBox.tpl.html",[],function(){return'<div class="nfshare-box-wrapper">\r\n\r\n  {{#raw}}\r\n\r\n  <script type="x-handlebars-template" id="createLinkTpl1">\r\n    <div class="nfshare-box-content">\r\n      <div class="nfshare-create-link">\r\n        <div class="nfshare-create-desc">\r\n          <i class="iconfont iconinformation"></i>\r\n          <span>[[i18n "file/lbl_share_desc"]]</span>\r\n        </div>\r\n      </div>\r\n      <div class="f-tac">\r\n        <button class="u-btn u-btn-primary btn-create" data-action="create">[[i18n "file/lbl_create_link"]]</button>\r\n      </div>\r\n    </div>\r\n  </script>\r\n\r\n  <script type="x-handlebars-template" id="createLinkTpl2">\r\n    <div class="nfshare-box-content">\r\n      <div class="nfshare-top">\r\n        <i class="iconfont iconpass"></i>\r\n        [[#if isExist]]\r\n        <span>[[i18n "file/msg_tips_share_link_exist"]]</span>\r\n        [[else]]\r\n        <span>[[i18n "file/msg_tips_share_link_created"]]</span>\r\n        [[/if]]\r\n        <button class="u-btn u-btn-default f-fr f-mgr btn-cancel" data-action="cancel">[[i18n "file/lbl_cancel_share"]]</button>\r\n      </div>\r\n      <div class="nfshare-middle">\r\n        <div class="u-form-item">\r\n          <label class="u-form-label">[[i18n "file/lbl_share_link"]]</label>\r\n          <input type="text" class="u-input share-link" readonly value="[[#if isExist]][[shareInfo.url]][[else]][[url]][[/if]]">\r\n        </div>\r\n        <div class="u-form-item">\r\n          <label class="u-form-label">[[i18n "file/lbl_share_code"]]</label>\r\n          <input type="text" class="u-input share-code" readonly value="[[#if isExist]][[shareInfo.password]][[else]][[password]][[/if]]">\r\n          <span class="f-mgl f-dn j-copy-success">[[i18n "file/msg_tips_share_copy_success"]]</span>\r\n        </div>\r\n      </div>\r\n      <textarea id="textToCopy" cols="30" rows="10" class="f-dn">\r\n         [[#if isExist]][[shareInfo.copyText]][[else]][[copyText]][[/if]]\r\n      </textarea>\r\n      <div class="nfshare-bottom">\r\n        <span class="gray">[[i18n "file/msg_tips_share_file_desc"]]</span>\r\n        <button class="u-btn u-btn-primary f-mgr f-fr j-copy-btn" title="[[i18n \'file/lbl_copy_info\']]" data-clipboard-action="copy"\r\n                data-clipboard-text="[[#if isExist]][[shareInfo.copyText]][[else]][[copyText]][[/if]]">\r\n          [[i18n "file/lbl_copy_info"]]\r\n        </button>\r\n      </div>\r\n    </div>\r\n  </script>\r\n  {{/raw}}\r\n</div>'}),define("component/personalnfShareBox",["require","i18n!file","text!../../template/component/nfShareBox.tpl.html","handlebars","jquery","../util/index","cui/ui/dialog/confirmbox","cui/util/templatable/templatable","../module/common/globalService","../module/file/fileService","widget/clipboard/clipboard"],function(e){e("i18n!file");var t=e("text!../../template/component/nfShareBox.tpl.html"),n=e("handlebars"),i=e("jquery"),a=e("../util/index"),r=e("cui/ui/dialog/confirmbox"),l=e("cui/util/templatable/templatable"),s=e("../module/common/globalService"),o=e("../module/file/fileService"),c=e("widget/clipboard/clipboard"),d=a.i18n,f=a.messageFormat.format,h=a.file.truncateName,m=i(n.compile(t)({})),u=r.extend({Implements:l,events:{"click [data-action]":"_dispatchAction"},setup:function(){var e=this;this.after("render",function(){e.element.addClass("u-nfshare-box")}),this.after("hide",function(){this.destroy()}),this.set("title",f(d.t("file/lbl_share_filename"),a.html.encode(h(this.get("fileInfo").name,20)))),u.superclass.setup.call(this)},attrs:{closeTpl:'<i class="iconfont icontabclose"></i>',confirmTpl:null,cancelTpl:null,message:null,height:270,width:416},render:function(){u.superclass.render.call(this),this.initView()},initView:function(){var e=this,t=this.get("fileInfo"),n={file_id:t.mid&&t.mid.substring(2)||t.fid,net_disk_uid:t.uid||s.getConfig("user.uid"),type:t.mid?"file":"folder"};o.getShareLinkInfo(n).then(function(t){t.isExist?(e._generateShareLinkAndCopyText(t.shareInfo),e.set("message",e.compile(m.find("#createLinkTpl2").html(),t)),e.set("shareInfo",t.shareInfo),e._initClipboard()):e.set("message",e.compile(m.find("#createLinkTpl1").html()))})},_dispatchAction:function(e,t){var n=i(t).data("action");switch(n){case"cancel":this._bindCancelShare();break;case"create":this._handleCreateLink()}},_handleCreateLink:function(){var e=this,t=this.get("fileInfo"),n={mid:t.mid&&t.mid.substring(2),fid:t.fid,uid:t.uid};o.createShareLink(n).then(function(t){e._generateShareLinkAndCopyText(t),e.set("message",e.compile(m.find("#createLinkTpl2").html(),t)),e.set("shareInfo",t),e._initClipboard()})},_initClipboard:function(){var e=this,t=this.$(".j-copy-btn");e.Clipboard=new c(t[0]).on("success",function(){e.$(".j-copy-success").show()}).on("error",function(e){console.error("copy error",e)})},_bindCancelShare:function(){var e=this,t=this.get("shareInfo").share_link_id,n=this.get("shareInfo").net_disk_uid;r.confirm(d.t("file/msg_tips_share_cancel_desc"),function(){o.cancelShareLink({uid:n,share_link_id:t}).then(function(){i.notify.success(d.t("file/msg_tips_share_cancel_success"))}),setTimeout(function(){e.hide()},0)},i.noop(),{title:d.t("file/lbl_cancel_share")})},_generateShareLinkAndCopyText:function(e){e.url=location.href.replace(/index.jsp(.+)/,"jsp/download.jsp?"+i.param({
share_link:e.share_link,uid:e.net_disk_uid})),e.copyText=f(d.t("file/msg_tips_share_link_template"),[e.url,e.password])},destroy:function(){this.Clipboard&&this.Clipboard.destroy(),u.superclass.destroy.call(this)}}),p={init:function(e){return this.each(function(){var t=i(this),n=i.extend({trigger:t},e);t.data("nfShareBox.settings",n),t.nfShareInstance||(t.nfShareInstance=new u({fileInfo:n}),t.data("nfShareBox.settings",t.nfShareInstance),t.nfShareInstance.show().after("hide",function(){t.data("nfShareBox.settings",null),this.destroy()}))})}};i.fn.nfShareBox=function(e){return p[e]?p[e].apply(this,Array.prototype.slice.call(arguments,1)):i.isPlainObject(e)?p.init.apply(this,arguments):void i.error("Method"+e+"does not exist on jQuery.nfShareBox")}}),define("components/requirejs-text/text!template/module/file/personalnf.tpl.html",[],function(){return'<div class="mfl-wrapper">\r\n  <div class="main-wrapper mfl-pnf-main">\r\n    <div class="mfl-pnf-auth2lock f-dni"></div>\r\n    <section class="mfl-pnf-wrap jfl-pnf-wrap u-scroll f-dni">\r\n      <iframe scrolling="no" frameborder="0" src=""></iframe>\r\n    </section>\r\n  </div>\r\n</div>'}),define("module/file/personalnf/index",["require","i18n!main,file,common,mbox","jquery","../../../widget/mask/mask","../../../component/personalnfShareBox","cui/core/view/view","cui/core/view/viewmanager","cui/util/templatable/templatable","../../../util/index","../../../configurable/index","module/common/globalService","module/mail/service","../../../component/userauth2","text!template/module/file/personalnf.tpl.html"],function(e){e("i18n!main,file,common,mbox");var t=e("jquery");e("../../../widget/mask/mask"),e("../../../component/personalnfShareBox");var n=e("cui/core/view/view"),i=e("cui/core/view/viewmanager"),a=e("cui/util/templatable/templatable"),r=e("../../../util/index"),l=e("../../../configurable/index"),s=e("module/common/globalService"),o=e("module/mail/service"),c=e("../../../component/userauth2"),d=n.extend({Implements:a,name:"file.personalnf",title:r.i18n.t("main/appname_NF"),$mainWrap:null,state:null,_iframeSrc:"",attrs:{},widgets:{},events:{},setup:function(){this._iframeSrc="nf/list.jsp?sid="+s.getSid(),this.state=s.getCurrentState(),delete this.state.param.view},render:function(){d.superclass.render.call(this),this.config=l("file.personalnf"),this.$mainWrap=this.$(".mfl-pnf-main"),this._checkAuth(),this._initModuleSubEvent(),t.notify.loading("hide")},destroy:function(){d.superclass.destroy.call(this)},_initModuleSubEvent:function(){var e=this;this.subscribe("component.userauth2","auth2Unlocked",function(){e._checkAuth()})},_checkAuth:function(){var e,t=this,n=s.getFolderLockedStatus(!0),i=this.$mainWrap.find(".mfl-pnf-auth2lock"),a=this.$mainWrap.find(".mfl-pnf-wrap"),r="f-dni";n.isAuth?(i.addClass(r),a.removeClass(r),t._initPnfJSP()):(i.removeClass(r),a.addClass(r),e=new c({root:i,successCb:function(){i.addClass(r),a.removeClass(r),e.close(),t._initPnfJSP.call(t)}}))},_initPnfJSP:function(){var e=this,n=function(){e._initJSPEvent(t(this))},i=function(){e.$mainWrap.mask("destroy")};this.$mainWrap.mask(),this.$mainWrap.find("iframe").attr("src",this._iframeSrc).on("load",n).one("load",i)},_initJSPEvent:function(e){var t=this,n=e.contents(),i=function(e){t._handleJSPToCompose(e)},a=function(e){t._handleJSPShareToRoot(e)},r=function(e){t._handleJSPToShare(e)};n.find(".xt5NfSendToCompose").off("click",i).on("click",i),n.find(".xt5NfSendToShare").off("click",r).on("click",r),n.find('#headControlArea [name="action:goBackToPNF"]').off("click",a).on("click",a)},_handleJSPToShare:function(e){var n=t(e.target),i=n.closest(".nffile"),a=i.data();t(e.target).nfShareBox(a)},_handleJSPToCompose:function(e){var n,i=t(e.target),a=this,r=i.closest(".nffile");return e.preventDefault(),r.length<=0?!1:(n=r.data("mid"),void o.getComposeInfo({ctype:"attach",mid:n}).then(function(e){a.sendMessage("dispatcher","history:add",{module:"mail.compose",param:{id:e.id}})}))},_handleJSPShareToRoot:function(e){e.preventDefault(),this._initPnfJSP()}});i.module({name:"file.personalnf",template:e("text!template/module/file/personalnf.tpl.html")},d)}),define("components/requirejs-text/text!template/module/file/enterprisenf.tpl.html",[],function(){return'<div class="mfl-wrapper">\r\n  <div class="main-wrapper mfl-enf-main">\r\n    <section class="mfl-enf-wrap jfl-enf-wrap u-scroll">\r\n      <iframe scrolling="no" frameborder="0" src=""></iframe>\r\n    </section>\r\n  </div>\r\n</div>'}),define("module/file/enterprisenf/index",["require","i18n!main,file,common,mbox","../../../component/personalnfShareBox","jquery","cui/core/view/view","cui/core/view/viewmanager","cui/util/templatable/templatable","../../../util/index","../../../configurable/index","module/common/globalService","module/mail/service","text!template/module/file/enterprisenf.tpl.html"],function(e){e("i18n!main,file,common,mbox"),e("../../../component/personalnfShareBox");var t=e("jquery"),n=e("cui/core/view/view"),i=e("cui/core/view/viewmanager"),a=e("cui/util/templatable/templatable"),r=e("../../../util/index"),l=e("../../../configurable/index"),s=e("module/common/globalService"),o=e("module/mail/service"),c=n.extend({Implements:a,name:"file.enterprisenf",title:r.i18n.t("main/appname_ENF"),mainWrap:".mfl-enf-wrap",state:null,enfUid:null,_iframeSrc:"",attrs:{},widgets:{},events:{},setup:function(){this._iframeSrc="nf/enfList.jsp?sid="+s.getSid()+"&uid="+s.getConfig("file.enfuid")+"&nav_type=enf",this.state=s.getCurrentState(),this.enfUid=s.getConfig("file.enfuid"),delete this.state.param.view},render:function(){var e=this,n=this.$(this.mainWrap);c.superclass.render.call(this),this.config=l("file.enterprisenf"),n.mask(),n.find("iframe").attr("src",this._iframeSrc).load(function(){e._initJSPEvent(t(this)),n.mask("destroy")}),t.notify.loading("hide")},destroy:function(){c.superclass.render.call(this)},_initJSPEvent:function(e){var t=this,n=e.contents();n.on("click",".xt5NfSendToCompose",function(e){t._handleJSPToCompose(e)}),n.on("click",".xt5NfSendToShare",function(e){t._handleJSPToShare(e)})},_handleJSPToCompose:function(e){var n,i=this,a=t(e.target),r=a.closest(".nffile");return e.preventDefault(),r.length<=0?!1:(n=r.data("mid"),void o.getComposeInfo({ctype:"attach",mid:n,uid:i.enfUid}).then(function(e){i.sendMessage("dispatcher","history:add",{module:"mail.compose",param:{id:e.id}})}))},_handleJSPToShare:function(e){var n=t(e.target),i=n.closest(".nffile"),a=t.extend(i.data(),{uid:this.enfUid});t(e.target).nfShareBox(a)}});i.module({name:"file.enterprisenf",template:e("text!template/module/file/enterprisenf.tpl.html")},c)}),define("components/requirejs-text/text!template/module/file/transitcenter.tpl.html",[],function(){return'<div class="mfl-wrapper">\r\n  <div class="main-wrapper mfl-trs-main">\r\n    <section class="mfl-trs-wrap jfl-trs-wrap u-scroll">\r\n      <iframe scrolling="no" frameborder="0" src=""></iframe>\r\n    </section>\r\n  </div>\r\n</div>'}),define("module/file/transitcenter/index",["require","i18n!main,file,common,mbox,nf","jquery","cui/core/view/view","cui/core/view/viewmanager","cui/util/templatable/templatable","../../../component/confirmbox","../../../util/i18n","../../../configurable/index","module/common/globalService","module/mail/service","text!template/module/file/transitcenter.tpl.html"],function(e){e("i18n!main,file,common,mbox,nf");var t=e("jquery"),n=e("cui/core/view/view"),i=e("cui/core/view/viewmanager"),a=e("cui/util/templatable/templatable"),r=e("../../../component/confirmbox"),l=e("../../../util/i18n"),s=e("../../../configurable/index"),o=e("module/common/globalService"),c=e("module/mail/service"),d=n.extend({Implements:a,name:"file.transitcenter",title:l.t("main/appname_BNF"),mainWrap:".mfl-trs-wrap",state:null,_iframeSrc:"",attrs:{},widgets:{},events:{},setup:function(){this._iframeSrc="nf/trsFileList.jsp?sid="+o.getSid()+"&fid="+o.getConfig("file.trsfid"),this.state=o.getCurrentState(),delete this.state.param.view},render:function(){d.superclass.render.call(this),this.config=s("file.transitcenter"),this._initModuleSubEvent(),this._renderJSP(),t.notify.loading("hide")},destroy:function(){d.superclass.render.call(this)},_initModuleSubEvent:function(){var e=this;this.onMessage("trsUpload",function(){e._renderJSP()}),this.onMessage("trsDestroy",function(){e._renderJSP()})},_initJSPEvent:function(e){var t=this,n=e.contents();n.off("click",".xt5TrsSendToCompose").on("click",".xt5TrsSendToCompose",function(e){t._handleJSPToCompose(e)}).off("click",".xt5TrsToComposeBatch").on("click",".xt5TrsToComposeBatch",function(e){t._handleJSPToComposeBatch(e)})},_renderJSP:function(){var e,n=this;e=this.$(this.mainWrap),e.mask(),e.find("iframe").off("load").attr("src",this._iframeSrc).load(function(){n._initJSPEvent(t(this)),e.mask("destroy")})},_handleJSPToCompose:function(e){var n,i=t(e.target),a=this,r=i.closest(".nffile");return e.preventDefault(),r.length<=0?!1:(n=r.data("mid"),void c.getComposeInfo({ctype:"trsAttach",mid:n}).then(function(e){a.sendMessage("dispatcher","history:add",{module:"mail.compose",param:{id:e.id}})}))},_handleJSPToComposeBatch:function(){var e,n=this,i=this.$(this.mainWrap).find("iframe").contents(),a=i.find("#nfList"),s={blankMsg:l.t("nf/error_send_mail"),notUploadedMsg:l.t("nf/error_file_not_uploaded")};e=a.find(".nffile tr.selected"),t.when(!0).then(function(){var n=t.Deferred(),i=[];return e.each(function(){var e=t(this),n=e.closest(".nffile");n.data("avssafe")&&i.push(n)}),e=i,n.resolve(),n.promise()}).then(function(){var n=t.Deferred();return e.length<=0?r.confirm(s.blankMsg,function(){setTimeout(function(){n.reject()},0)},null,{cancelTpl:!1}):n.resolve(),n.promise()}).then(function(){var n=t.Deferred(),i=!0;return t.each(e,function(e,t){return t.data("complete")?void 0:(i=!1,!1)}),i?n.resolve():r.confirm(s.notUploadedMsg,function(){setTimeout(function(){n.reject()},0)},null,{cancelTpl:!1}),n.promise()}).then(function(){var t=[];e.forEach(function(e){t[t.length]=e.data("mid")}),c.getComposeInfo({mid:t,ctype:"trsAttach"}).then(function(e){n.sendMessage("dispatcher","history:add",{module:"mail.compose",param:{id:e.id}})})})}});i.module({name:"file.transitcenter",template:e("text!template/module/file/transitcenter.tpl.html")},d)}),define("components/requirejs-text/text!template/module/file/file.tpl.html",[],function(){return'<section class="m-file j-file">\r\n  <div class="fl-main"></div>\r\n\r\n  {{#raw}}\r\n\r\n  <script type="x-handlebars-template" id="forbiddenTpl" data-container=".fl-main">\r\n    <div class="fl-forbidden">[[ i18n "pref/fa_forbidden" ]]</div>\r\n  </script>\r\n\r\n  <script type="x-handlebars-template" id="contentTpl" data-container=".fl-main">\r\n    <aside class="fl-g-sidebar">\r\n      <div class="fl-m-nav-bg"></div>\r\n      <ul class="fl-m-nav j-file-nav">\r\n        [[#each this]]\r\n        <li>\r\n          <a class="fl-m-nav-trigger" href="javascript:void(0)" data-trigger=[[ this.id ]] title="[[ this.title ]]">\r\n              <span>\r\n                <i class="iconfont [[this.icon]]"></i>\r\n                [[ this.title ]]\r\n              </span>\r\n          </a>\r\n        </li>\r\n        [[/each]]\r\n      </ul>\r\n    </aside>\r\n    <article class="fl-g-content">\r\n      <div class="fl-g-content-bg"></div>\r\n      <div class="fl-g-content-main j-file-content"></div>\r\n    </article>\r\n  </script>\r\n\r\n  {{/raw}}\r\n</section>'}),define("module/file/index",["require","module/file/accessory/index","module/file/personalnf/index","module/file/enterprisenf/index","module/file/transitcenter/index","i18n!main,file,common,mbox,pref","jquery","cui/core/view/view","cui/core/view/viewmanager","cui/util/templatable/templatable","cui/ui/tabview/tabview","../../util/i18n","../../configurable/index","module/common/globalService","text!template/module/file/file.tpl.html"],function(e){function t(e,t){var n,a;n=e.module.split("."),a=n[1],a||(null===t.activeTabId?i.each(f,function(e){return a=e,!1}):a=t.activeTabId,e.module="file."+a),delete e.param.view}function n(e,t){var n,a,l,s=e.widgets.tabview.current(),o=s.sid;return t=i.extend({module:"",param:{}},t),n=t.module.split("."),a=n[0],l=n[1],"file"!=a?!1:o==l?!1:(e.activeTabId=l,d.setCurrentState(t),void(e.widgets.tabview.find(l)?e.widgets.tabview.switchTo(l):e.widgets.tabview.addTab({id:o,title:f[o].title,module:r.module(f[o].name)})))}e("module/file/accessory/index"),e("module/file/personalnf/index"),e("module/file/enterprisenf/index"),e("module/file/transitcenter/index"),e("i18n!main,file,common,mbox,pref");var i=e("jquery"),a=e("cui/core/view/view"),r=e("cui/core/view/viewmanager"),l=e("cui/util/templatable/templatable"),s=e("cui/ui/tabview/tabview"),o=e("../../util/i18n"),c=e("../../configurable/index"),d=e("module/common/globalService"),f={personalnf:{name:"file.personalnf",view:"personalnf",title:o.t("main/appname_NF"),icon:"iconmyfile"},enterprisenf:{name:"file.enterprisenf",view:"enterprisenf",title:o.t("main/appname_ENF"),icon:"iconcompanyfile"},transitcenter:{name:"file.transitcenter",view:"transitcenter",title:o.t("main/appname_BNF"),icon:"iconhubfile"},accessory:{name:"file.accessory",view:"accessory",title:o.t("file/lbl_accessory_dealings"),icon:"iconaccfile"}},h=a.extend({Implements:l,name:"file",attrs:{},state:null,widgets:{tabView:null},activeTabId:null,setup:function(){var e=d.getFolderLockedStatus(!0).isAuth,n=c("file");!n.enableAtt&&delete f.accessory,!n.enablePNF&&delete f.personalnf,!n.enableENF&&delete f.enterprisenf,!n.enableTrs&&delete f.transitcenter,this.state=d.getCurrentState(),t(this.state,this),this.activeTabId=this.state.module.split(".")[1]||(e?"personalnf":"enterprisenf"),!this.state.param.vid&&(this.state.param.vid=this.state.module),this.sendMessage("dispatcher","view:render",this.state)},render:function(){h.superclass.render.call(this),f.length<=0||"undefined"==typeof f[this.activeTabId]?this._renderForbidden():(this._initModuleEvent(),this._initTabView()),i.notify.loading("hide")},destroy:function(){this.widgets.tabview&&this.widgets.tabview.destroy(),h.superclass.destroy.call(this)},_initModuleEvent:function(){var e=this;this.subscribe("dispatcher","url:changed",function(i){var a=i.message.newState,r=a.module.split(".");"file"===r[0]&&(t(a,e),n(e,a))})},_initTabView:function(){var e,t=this,n=[],a=this.$("#contentTpl");i.each(f,function(e,t){n.push({id:e,module:r.module(t.name),title:t.title,icon:t.icon})}),e=this.compile(a.html(),n),this.$(a.attr("data-container")).html(e),this.widgets.tabview=new s({element:"section.j-file",classPrefix:"j-file",onlyRenderActive:!0,activeTriggerClass:"fl-nav-current",activeTabId:t.activeTabId,tabs:n}),this.widgets.tabview.render(),this.widgets.tabview.on("render",function(e){var n,i=e.split(":");t.activeTabId=i[0],n={module:"file."+e,param:{}},n.param.vid=e,t._setHistory(n)}),this.widgets.tabview.on("refresh",function(e){var n=e.split(":");t.activeTabId=n[0],t.sendMessage("dispatcher","view:refresh",{module:"file."+n[0],param:{vid:e}})})},_renderForbidden:function(){var e=this.$("#forbiddenTpl"),t=this.compile(e.html()),n=this.$(e.attr("data-container"));n.html(t)},_setHistory:function(e){var t,n=i.extend(!0,{},e);t=n.module.split(".")[1],t&&(n.param.vid=e.param.vid,this.sendMessage("dispatcher","view:render",n))}});r.module({name:"file",template:e("text!template/module/file/file.tpl.html")},h)});
//# sourceMappingURL=index.js.map